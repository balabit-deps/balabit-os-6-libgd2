From 38241013cc048af7c03daf6e9a75b4f42bffb200 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ond=C5=99ej=20Sur=C3=BD?= <ondrej@sury.org>
Date: Fri, 20 May 2016 09:39:38 +0200
Subject: [PATCH] CVE-2015-8874

---
 src/gd.c | 11 +++++++++++
 1 file changed, 11 insertions(+)

Index: libgd2-2.1.1/src/gd.c
===================================================================
--- libgd2-2.1.1.orig/src/gd.c	2016-05-26 09:21:57.228584633 -0400
+++ libgd2-2.1.1/src/gd.c	2016-05-26 09:21:57.224584584 -0400
@@ -1941,6 +1941,17 @@
 	restoreAlphaBleding = im->alphaBlendingFlag;
 	im->alphaBlendingFlag = 0;
 
+	if (x >= im->sx) {
+		x = im->sx - 1;
+	} else if (x < 0) {
+		x = 0;
+	}
+	if (y >= im->sy) {
+		y = im->sy - 1;
+	} else if (y < 0) {
+		y = 0;
+	}
+	
 	for (i = x; (i >= 0); i--) {
 		if (gdImageGetPixel (im, i, y) == border) {
 			break;
