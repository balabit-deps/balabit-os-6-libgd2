From 71f2ff370e5101c72e89fe4c84c103634a0e7ed9 Mon Sep 17 00:00:00 2001
From: "Christoph M. Becker" <cmbecker69@gmx.de>
Date: Tue, 19 Jul 2016 11:40:19 +0200
Subject: [PATCH] Fix #264: TGA warning coverity

We fix the unintended sign extension issue #150385 by declaring encoded_pixels
as int, and the logical vs. bitwise operator issue #150382 by using the
proper operator.
---
 src/gd_tga.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

Index: libgd2-2.1.1/src/gd_tga.c
===================================================================
--- libgd2-2.1.1.orig/src/gd_tga.c	2017-02-28 10:21:25.263953073 -0500
+++ libgd2-2.1.1/src/gd_tga.c	2017-02-28 10:21:25.259953025 -0500
@@ -196,7 +196,7 @@
 	int buffer_caret = 0;
 	int bitmap_caret = 0;
 	int i = 0;
-	uint8_t encoded_pixels;
+	int encoded_pixels;
 
 	if(overflow2(tga->width, tga->height)) {
 		return -1;
@@ -291,7 +291,7 @@
 		while( bitmap_caret < image_block_size ) {
 			
 			if ((decompression_buffer[buffer_caret] & TGA_RLE_FLAG) == TGA_RLE_FLAG) {
-				encoded_pixels = ( ( decompression_buffer[ buffer_caret ] & !TGA_RLE_FLAG ) + 1 );
+				encoded_pixels = ( ( decompression_buffer[ buffer_caret ] & ~TGA_RLE_FLAG ) + 1 );
 				buffer_caret++;
 
 				if ((bitmap_caret + (encoded_pixels * pixel_block_size)) >= image_block_size) {
